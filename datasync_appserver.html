<!-- HTML header for doxygen 1.8.13-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>QtDataSync: qdsapp Documentation</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0" style="display: inline;">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">QtDataSync
   &#160;<span id="projectnumber">4.2.0</span>
   </div>
   <div id="projectbrief">A simple offline-first synchronisation framework, to synchronize data of Qt applications between devices</div>
  </td>
 </tr>
 </tbody>
</table>
<a style="float: right;" target="_blank"  href="https://github.com/Skycoder42/QtDataSync">
<img style="padding: 10px;" src="GitHub_Logo.png"/>
</a>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">qdsapp Documentation </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#datasync_appserver_install">Requirements and installation</a><ul><li class="level2"><a href="#datasync_appserver_install_postgre">PostgreSQL</a></li>
<li class="level2"><a href="#datasync_appserver_install_qdsapp">qdsapp server</a></li>
</ul>
</li>
<li class="level1"><a href="#datasync_appserver_usage">Usage</a><ul><li class="level2"><a href="#datasync_appserver_usage_service">Using it as a service</a></li>
<li class="level2"><a href="#datasync_appserver_usage_config">The configuration file</a><ul><li class="level3"><a href="#datasync_appserver_usage_config_general">The `general` section</a></li>
<li class="level3"><a href="#datasync_appserver_usage_config_database">The `database` section</a></li>
<li class="level3"><a href="#datasync_appserver_usage_config_server">The `server` section</a></li>
</ul>
</li>
</ul>
</li>
<li class="level1"><a href="#datasync_appserver_cleanup">The database cleanup</a></li>
</ul>
</div>
<div class="textblock"><p>The documentation for the backend server application coming with datasync</p>
<p>This page describes how to use appserver. You can follow this document to find out what you can configure etc.</p>
<h1><a class="anchor" id="datasync_appserver_install"></a>
Requirements and installation</h1>
<h2><a class="anchor" id="datasync_appserver_install_postgre"></a>
PostgreSQL</h2>
<p>All appserver needs as additional setup is a connection to a postgresql database. Simply install PostgreSQL on your server machine, and create a database (and a user). If you want to use docker, you can use the <a href="https://hub.docker.com/_/postgres/">docker image</a> of PostgreSQL. There is no additional setup needed. Since table creation etc is done by the server itself.</p>
<h2><a class="anchor" id="datasync_appserver_install_qdsapp"></a>
qdsapp server</h2>
<p>For the server, all you need is a standard deployment, e.g. the <a class="elRef" target="_blank" doxygen="/home/sky/Qt/Docs/Qt-5.11.2/qtcore/qtcore.tags:https://doc.qt.io/qt-5/" href="https://doc.qt.io/qt-5/qt.html">Qt</a> libraries. The application itself can be copied from the bin folder of your installation. If you use the libraries from there as well, it will work fine. Have a look at the deployment pages for details:</p><ul>
<li><a href="https://doc.qt.io/qt-5/linux-deployment.html">Linux</a></li>
<li><a href="https://doc.qt.io/qt-5/windows-deployment.html">Windows</a></li>
<li><a href="https://doc.qt.io/qt-5/osx-deployment.html">MacOs</a></li>
</ul>
<p>If you install it via one of the package managers, it becomes even easier Check the README for the support package managers. The server also comes with systemd and launchd files to use it as system service, and implements the windows service API, so it can be used as windows service as well.</p>
<p>qdsapp is also available as a docker image based on ubuntu rolling. Have a look at <a href="https://hub.docker.com/r/skycoder42/qdsapp/">qdsapp</a> on dockerhub.</p>
<h1><a class="anchor" id="datasync_appserver_usage"></a>
Usage</h1>
<p>For now, there is not really a CLI implemented. This will come as soon as the service API has been implemented. For now, all you can do is start the server. The configuration is done via a configuration file</p>
<h2><a class="anchor" id="datasync_appserver_usage_service"></a>
Using it as a service</h2>
<p>TODO comming soon</p>
<h2><a class="anchor" id="datasync_appserver_usage_config"></a>
The configuration file</h2>
<p>The configuration file is all you need to properly setup the server. It's a rather small config, in the <code>.ini</code> file format. On start, the server will search for the file in usual places. The order used to find the file is as follows:</p>
<ol type="1">
<li>The path defined in the <code>QDSAPP_CONFIG_FILE</code> environment variable</li>
<li>A file named <code>qdsappd.conf</code> (unix), <code>qdsappsvc.conf</code> (win) or <code>qdsapp.conf</code> (any) in one of the following locations, ordered by how they are searched:<ol type="a">
<li>The paths listed in the <code>QDSAPP_CONFIG_PATH</code> environment variable, seperated by the system path seperator</li>
<li>The Paths identified by QStandardPaths::ConfigLocation</li>
<li>The Paths identified by QStandardPaths::GenericConfigLocation</li>
<li>In <code>/etc/</code> (unix)</li>
<li>In the directoy of the running binary (win)</li>
</ol>
</li>
</ol>
<p>An simple example for such a config file would be: </p><div class="fragment"><div class="line">[general]</div><div class="line">loglevel=4</div><div class="line"></div><div class="line">[server]</div><div class="line">host=localhost</div><div class="line">port=4242</div><div class="line"></div><div class="line">[database]</div><div class="line">host=localhost</div><div class="line">port=15432</div><div class="line">password=baum42</div></div><!-- fragment --><p>The next sections describe the different parts of the configuration file</p>
<h3><a class="anchor" id="datasync_appserver_usage_config_general"></a>
The `general` section</h3>
<p>The general section contains stuff to globally configure the server.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Key  </th><th class="markdownTableHeadNone">Type  </th><th class="markdownTableHeadNone">Default value  </th><th class="markdownTableHeadNone">Describtion   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">threads/count  </td><td class="markdownTableBodyNone">integer  </td><td class="markdownTableBodyNone"><a class="elRef" target="_blank" doxygen="/home/sky/Qt/Docs/Qt-5.11.2/qtcore/qtcore.tags:https://doc.qt.io/qt-5/" href="https://doc.qt.io/qt-5/qthread.html#idealThreadCount">QThread::idealThreadCount()</a>  </td><td class="markdownTableBodyNone">The maximum of threads the server can use in it's threadpool   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">threads/expire  </td><td class="markdownTableBodyNone">integer  </td><td class="markdownTableBodyNone">10  </td><td class="markdownTableBodyNone">The timeout (in minutes) after which unused threads expire and get removed (Every thread has it's own database connection)   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">livesync  </td><td class="markdownTableBodyNone">bool  </td><td class="markdownTableBodyNone">true  </td><td class="markdownTableBodyNone">Enable or disable live synchronization (change events for clients)   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">cleanup/interval  </td><td class="markdownTableBodyNone">integer  </td><td class="markdownTableBodyNone">90  </td><td class="markdownTableBodyNone">The number of days a device must be offline to be seen as inactive and thus must be removed   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">cleanup/auto  </td><td class="markdownTableBodyNone">bool  </td><td class="markdownTableBodyNone">true  </td><td class="markdownTableBodyNone">Enable or disable the automatic removal of devices that are inactive (See cleanup/interval)   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">quota/limit  </td><td class="markdownTableBodyNone">integer  </td><td class="markdownTableBodyNone">10485760 (10 MB)  </td><td class="markdownTableBodyNone">The limit in bytes each account can store on the server at most. This is only temporal storage and thus can be kept small   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">quota/force  </td><td class="markdownTableBodyNone">bool  </td><td class="markdownTableBodyNone">false  </td><td class="markdownTableBodyNone">If enabled and the interval changes, all accounts that have more data then the quota limit are deleted   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">loglevel  </td><td class="markdownTableBodyNone">integer  </td><td class="markdownTableBodyNone">3 (release), 4 (debug)  </td><td class="markdownTableBodyNone">The loglevel. The levels are: 0 (nothing), 1 (critical), 2 (warning), 3 (info), 4 (debug)   </td></tr>
</table>
<h3><a class="anchor" id="datasync_appserver_usage_config_database"></a>
The `database` section</h3>
<p>This section is used to set up the database connection.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Key  </th><th class="markdownTableHeadNone">Type  </th><th class="markdownTableHeadNone">Default value  </th><th class="markdownTableHeadNone">Describtion   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">driver  </td><td class="markdownTableBodyNone">string  </td><td class="markdownTableBodyNone">"QPSQL"  </td><td class="markdownTableBodyNone">The database driver to use. Leave out for PostgreSQL   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">name  </td><td class="markdownTableBodyNone">string  </td><td class="markdownTableBodyNone"><a class="elRef" target="_blank" doxygen="/home/sky/Qt/Docs/Qt-5.11.2/qtcore/qtcore.tags:https://doc.qt.io/qt-5/" href="https://doc.qt.io/qt-5/qcoreapplication.html#applicationName-prop">QCoreApplication::applicationName()</a>  </td><td class="markdownTableBodyNone">The name of the database to connect to   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">host  </td><td class="markdownTableBodyNone">string  </td><td class="markdownTableBodyNone">"localhost"  </td><td class="markdownTableBodyNone">The host to connect to   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">port  </td><td class="markdownTableBodyNone">integer  </td><td class="markdownTableBodyNone">5432  </td><td class="markdownTableBodyNone">The port to connect to   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">username  </td><td class="markdownTableBodyNone">string  </td><td class="markdownTableBodyNone">""  </td><td class="markdownTableBodyNone">The username to use   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">password  </td><td class="markdownTableBodyNone">string  </td><td class="markdownTableBodyNone">""  </td><td class="markdownTableBodyNone">The password for that username   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">options  </td><td class="markdownTableBodyNone">string  </td><td class="markdownTableBodyNone">""  </td><td class="markdownTableBodyNone">Additional database options. See <a class="elRef" target="_blank" doxygen="/home/sky/Qt/Docs/Qt-5.11.2/qtsql/qtsql.tags:https://doc.qt.io/qt-5/" href="https://doc.qt.io/qt-5/qsqldatabase.html#setConnectOptions">QSqlDatabase::setConnectOptions</a>   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">keepaliveInterval  </td><td class="markdownTableBodyNone">integer  </td><td class="markdownTableBodyNone">5  </td><td class="markdownTableBodyNone">The interval (in minutes) to send keepalive queries in for the event connection   </td></tr>
</table>
<h3><a class="anchor" id="datasync_appserver_usage_config_server"></a>
The `server` section</h3>
<p>This section is used to set up the websocker server. This part is what clients will connect to.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Key  </th><th class="markdownTableHeadNone">Type  </th><th class="markdownTableHeadNone">Default value  </th><th class="markdownTableHeadNone">Describtion   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">name  </td><td class="markdownTableBodyNone">string  </td><td class="markdownTableBodyNone"><a class="elRef" target="_blank" doxygen="/home/sky/Qt/Docs/Qt-5.11.2/qtcore/qtcore.tags:https://doc.qt.io/qt-5/" href="https://doc.qt.io/qt-5/qcoreapplication.html#applicationName-prop">QCoreApplication::applicationName()</a>  </td><td class="markdownTableBodyNone">The servers name, presented in the websocket handshake   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">host  </td><td class="markdownTableBodyNone">string  </td><td class="markdownTableBodyNone">"0.0.0.0" (any)  </td><td class="markdownTableBodyNone">The host address to listen on. Can be used to limit access   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">port  </td><td class="markdownTableBodyNone">integer  </td><td class="markdownTableBodyNone">0 (random)  </td><td class="markdownTableBodyNone">The port to bind to. If 0, a random port is choosen   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">secret  </td><td class="markdownTableBodyNone">string  </td><td class="markdownTableBodyNone">""  </td><td class="markdownTableBodyNone">The server secret. All clients need to pass it if the want to connect. If left empty, no secret is required. See QtDataSync::RemoteConfig::Secret   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">idleTimeout  </td><td class="markdownTableBodyNone">integer  </td><td class="markdownTableBodyNone">5  </td><td class="markdownTableBodyNone">A timeout (in minutes) after which a client is automatically disconnected if he did not send the idle ping   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">uploads/limit  </td><td class="markdownTableBodyNone">integer  </td><td class="markdownTableBodyNone">10  </td><td class="markdownTableBodyNone">The maximum number of parallel uploads from a client   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">downloads/limit  </td><td class="markdownTableBodyNone">integer  </td><td class="markdownTableBodyNone">20  </td><td class="markdownTableBodyNone">The maximum number of parallel downloads to a client   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">downloads/threshold  </td><td class="markdownTableBodyNone">integer  </td><td class="markdownTableBodyNone">10  </td><td class="markdownTableBodyNone">A threshold of "free" download spots. Only if a client has less the (limit - threshold) active downloads, new downloads are started   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">wss  </td><td class="markdownTableBodyNone">bool  </td><td class="markdownTableBodyNone">false  </td><td class="markdownTableBodyNone">Enable a secure (SSL) server. If you set it to true, the other wss/ fields need to be set as well   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">wss/pfx  </td><td class="markdownTableBodyNone">string  </td><td class="markdownTableBodyNone">""  </td><td class="markdownTableBodyNone">A path to a PKCS#12 file, containing the certificate to use by the server, as well as the private key   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">wss/pass  </td><td class="markdownTableBodyNone">string  </td><td class="markdownTableBodyNone">""  </td><td class="markdownTableBodyNone">The password for the PKCS#12 file   </td></tr>
</table>
<dl class="section note"><dt>Note</dt><dd>The <code>downloads/limit</code> and <code>downloads/threshold</code> care used to optimize database access. Instead of sending one dataset at a time, they are packed into batches. This speeds up the whole process and reduces the load on the database. The two can be used to tune that behaviour.</dd></dl>
<h1><a class="anchor" id="datasync_appserver_cleanup"></a>
The database cleanup</h1>
<p>A final note on the (automatic) cleanup. This procedure simply removes all devices that haven't logged in since a defined number of days. For most cases, this means that the user stopped using that device or your application. In order to prevent the database from overflowing with garbage data, this cleanup can remove such devices.</p>
<p>For the user this means that if he tries to use that device again he will see an authentication error and must add the device again to the account just like any new device. In case all devices got remove, he must create a new account.</p>
<p>Please note that no local data gets lost, as it is possible to keep all local data when creating a new account or adding a device.</p>
<p>It is also possible to completly disable this setting <code>cleanup/auto</code> to false. In that case only explicit cleanups triggered by explicitly invoking the service can be performed. It is also possible to simply increase the interval to like 3 years. This reduces the chances of a user actually using the app again after the timeout. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sat Nov 17 2018 11:30:53 for QtDataSync by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.14
</small></address>
</body>
</html>
