<!-- HTML header for doxygen 1.8.13-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>QtDataSync: qdatasyncserver Documentation</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0" style="display: inline;">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">QtDataSync
   &#160;<span id="projectnumber">3.0.1</span>
   </div>
   <div id="projectbrief">A simple offline-first synchronisation framework, to synchronize data of Qt applications between devices</div>
  </td>
 </tr>
 </tbody>
</table>
<a style="float: right;" target="_blank"  href="https://github.com/Skycoder42/QtDataSync">
<img style="padding: 10px;" src="GitHub_Logo.png"/>
</a>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">qdatasyncserver Documentation </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#qdatasyncserver_install">Requirements and installation</a><ul><li class="level2"><a href="#qdatasyncserver_install_postgre">PostgreSQL</a></li>
<li class="level2"><a href="#qdatasyncserver_install_qdatasyncserver">qdatasyncserver</a><ul><li class="level3"><a href="#qdatasyncserver_install_docker">Docker Image</a></li>
</ul>
</li>
</ul>
</li>
<li class="level1"><a href="#qdatasyncserver_cli">Command line usage</a><ul><li class="level2"><a href="#qdatasyncserver_cli_instance">Multiple instances</a></li>
</ul>
</li>
<li class="level1"><a href="#qdatasyncserver_config">The Configuration file</a><ul><li class="level2"><a href="#qdatasyncserver_config_general">Section general</a></li>
<li class="level2"><a href="#qdatasyncserver_config_db">Section database</a></li>
<li class="level2"><a href="#qdatasyncserver_config_network">Section network</a></li>
</ul>
</li>
<li class="level1"><a href="#qdatasyncserver_cleanup">Database cleanup</a></li>
</ul>
</div>
<div class="textblock"><p>The documentation for the server application coming with datasync</p>
<p>This page describes how to use qdatasync server. You can follow this document to find out what you can configure etc.</p>
<h1><a class="anchor" id="qdatasyncserver_install"></a>
Requirements and installation</h1>
<h2><a class="anchor" id="qdatasyncserver_install_postgre"></a>
PostgreSQL</h2>
<p>All qdatasyncserver needs as additional setup is a connection to a postgresql database. Simply install PostgreSQL on your server machine, and create a database (and a user) for qdatasync. If you want to use docker, you can use the <a href="https://hub.docker.com/_/postgres/">docker image</a> of PostgreSQL. There is no additional setup needed. Since table creation etc is done by the server itself.</p>
<h2><a class="anchor" id="qdatasyncserver_install_qdatasyncserver"></a>
qdatasyncserver</h2>
<p>For the server, all you need is a standard deployment, e.g. the <a class="elRef" target="_blank" doxygen="/home/sky/Qt/Docs/Qt-5.9/qtcore/qtcore.tags:https://doc.qt.io/qt-5/" href="https://doc.qt.io/qt-5/qt.html">Qt</a> libraries. The application itself can be copied from the bin folder of your installation. If you use the libraries from there as well, it will work fine. Have a look at the deployment pages for details:</p><ul>
<li><a href="https://doc.qt.io/qt-5/linux-deployment.html">Linux</a></li>
<li><a href="https://doc.qt.io/qt-5/windows-deployment.html">Windows</a></li>
<li><a href="https://doc.qt.io/qt-5/osx-deployment.html">MacOs</a></li>
</ul>
<h3><a class="anchor" id="qdatasyncserver_install_docker"></a>
Docker Image</h3>
<p>qdatasyncserver is available as docker image as well. This way you can skip all the setup stuff! Have a look at <a href="https://hub.docker.com/r/skycoder42/qdatasyncserver/">qdatasyncserver</a> on dockerhub!</p>
<h1><a class="anchor" id="qdatasyncserver_cli"></a>
Command line usage</h1>
<p>The CLI is rather simple, you call <code>qdatasyncserver start</code> to start the server and <code>qdatasyncserver stop</code> to stop it. Both commands will start the server in background (as a daemon) and then return. You can specify additional arguments for the start. The most important one would be <code>qdatasyncserver start -c &lt;path_to_config&gt;</code>. It allows you to specify a different config file then the default one. That one is located at <code>/etc/qdatasyncserver/setup.conf</code> for unix like systems, and a local path for others. Run <code>qdatasyncserver --help</code> for all available commands.</p>
<h2><a class="anchor" id="qdatasyncserver_cli_instance"></a>
Multiple instances</h2>
<p>qdatasyncserver is a single instance application. However, you may want to have multiple instances running in parallel, to provide different endpoints for different applications. You can, by using the <code>--id</code> parameter. By specifying the id, start will create a new instance for that id, and other commands know which instance to use. Commands look like <code>qdatasyncserver --id myId start</code> or <code>qdatasyncserver --id myId stop</code>.</p>
<h1><a class="anchor" id="qdatasyncserver_config"></a>
The Configuration file</h1>
<p>The configuration file is all you need to properly setup the server. It's a rather small config, in the <code>.ini</code> file format. An example for such a config file would be: </p><div class="fragment"><div class="line">[general]</div><div class="line">name=QtDataSync-TestServer</div><div class="line"></div><div class="line">[server]</div><div class="line">host=localhost</div><div class="line">port=4242</div><div class="line">secret=baum42</div><div class="line"></div><div class="line">[database]</div><div class="line">name=QtDataSync</div><div class="line">host=localhost</div><div class="line">port=15432</div><div class="line">username=qtdatasync</div><div class="line">password=baum42</div></div><!-- fragment --><p>The default file location can be found by running <code>qdatasyncserver --help</code> and checking the description of the <code>-c</code> option.</p>
<h2><a class="anchor" id="qdatasyncserver_config_general"></a>
Section general</h2>
<p>The general section contains stuff to globally configure the server.</p>
<table class="doxtable">
<tr>
<th>Key </th><th>Type </th><th>Default value </th><th>Describtion  </th></tr>
<tr>
<td>name </td><td>string </td><td>"qdatasyncserver" </td><td>The servers internal name. Use for logging etc. </td></tr>
<tr>
<td>threads </td><td>integer </td><td><a class="elRef" target="_blank" doxygen="/home/sky/Qt/Docs/Qt-5.9/qtcore/qtcore.tags:https://doc.qt.io/qt-5/" href="https://doc.qt.io/qt-5/qthread.html#idealThreadCount">QThread::idealThreadCount()</a> </td><td>The maximum of threads the server can use in it's threadpool </td></tr>
</table>
<h2><a class="anchor" id="qdatasyncserver_config_db"></a>
Section database</h2>
<p>This section is used to set up the database connection.</p>
<table class="doxtable">
<tr>
<th>Key </th><th>Type </th><th>Default value </th><th>Describtion  </th></tr>
<tr>
<td>driver </td><td>string </td><td>"QPSQL" </td><td>The database driver to use. Leave out for PostgreSQL </td></tr>
<tr>
<td>name </td><td>string </td><td>[general]/name </td><td>The name of the database to connect to </td></tr>
<tr>
<td>host </td><td>string </td><td>"localhost" </td><td>The host to connect to </td></tr>
<tr>
<td>port </td><td>integer </td><td>5432 </td><td>The port to connect to </td></tr>
<tr>
<td>username </td><td>string </td><td>"" </td><td>The username to use </td></tr>
<tr>
<td>password </td><td>string </td><td>"" </td><td>The password for that username </td></tr>
<tr>
<td>options </td><td>string </td><td>"" </td><td>Additional database options. See <a class="elRef" target="_blank" doxygen="/home/sky/Qt/Docs/Qt-5.9/qtsql/qtsql.tags:https://doc.qt.io/qt-5/" href="https://doc.qt.io/qt-5/qsqldatabase.html#setConnectOptions">QSqlDatabase::setConnectOptions</a> </td></tr>
</table>
<h2><a class="anchor" id="qdatasyncserver_config_network"></a>
Section network</h2>
<p>This section is used to set up the websocker server. This part is what clients will connect to.</p>
<table class="doxtable">
<tr>
<th>Key </th><th>Type </th><th>Default value </th><th>Describtion  </th></tr>
<tr>
<td>name </td><td>string </td><td>[general]/name </td><td>The servers name, presented in the websocket handshake </td></tr>
<tr>
<td>host </td><td>string </td><td>"0.0.0.0" (any) </td><td>The host address to listen on. Can be used to limit access </td></tr>
<tr>
<td>port </td><td>integer </td><td>0 (random) </td><td>The port to bind to. If 0, a random port is choosen </td></tr>
<tr>
<td>secret </td><td>string </td><td>"" </td><td>The server secret. All clients need to pass it if the want to connect. See WsAuthenticator::serverSecret </td></tr>
<tr>
<td>wss </td><td>bool </td><td>false </td><td>Enable a secure (SSL) server. If you set it to true, the other wss/ fields need to be set as well </td></tr>
<tr>
<td>wss/pfx </td><td>string </td><td>"" </td><td>A path to a PKCS#12 file, containing the certificate to use by the server, as well as the private key </td></tr>
<tr>
<td>wss/pass </td><td>string </td><td>"" </td><td>The password for the PKCS#12 file </td></tr>
</table>
<h1><a class="anchor" id="qdatasyncserver_cleanup"></a>
Database cleanup</h1>
<p>While the database is running, it will accumulate garbage, unused accounts and devices etc. You can use the cleanup while it is running to remove all those. The cleanup is reported live to your console.</p>
<dl class="section warning"><dt>Warning</dt><dd>Please be aware that this is a potentially destructive action and is not invertable. If you accidentially delete user accounts etc, it may displease users. You should always be careful.</dd></dl>
<p>The cleanup can be invoked by calling <code>qdatasyncserver cleanup [targets]</code>. The targets are what you want to cleanup. Those can be, in any order:</p><ul>
<li><b>devices &lt;days&gt;:</b> Removes all devices that have not connected since <code>&lt;days&gt;</code> days. This will delete all those devices as well as their change state. Please note that this action is not dangerous an it's own. If a device gets deleted that is still in use, all that happens is that the user will have to resync, just as if he had connected for the first time with the device</li>
<li><b>users:</b> Removes all users, <b>including their data</b>, that have no devices in the database. Please be careful with this command, because it will actually delete a users data! Especially if combined with the devices target, this can cause great data loss.</li>
<li><b>data:</b> Removes orphaned data nodes. This command is save as well, because it only removes data that is not used anymore. Such data should not come to existance in the first place, but sometimes it happens.</li>
<li><b>resync:</b> Sets the resync flag for <b>all</b> devices. Use with care, because resync means all users need to completely resync all data, and this means high data exchange. You can use this target if the servers synchronization state gets corrupted (e.g. after a backup recovery) to make shure all clients get back to a valid sync state.</li>
</ul>
<p>As an example, the following example would remove all devices and users, that have not connected for one year: <code>users devices 365 users</code>. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Mon Jun 5 2017 15:15:34 for QtDataSync by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
